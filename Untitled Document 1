import org.apache.ofbiz.entity.GenericEntityException;

def PersonRecordService() {
    result = [:];

//        personEntity = delegator.makeValue("PersonEntity");
//        personEntity.setNextSeqId();
//        personEntity.setPKFields(context);
//        personEntity.setNonPKFields(context);

        String partyId = (String) context.get("partyId");
//        Debug.log("====================1partyId::"+partyId);
//        Thread.dumpStack();
        try {

            party = from("PersonEntity").where("partyId",partyId).queryOne();
//              Debug.log("=========================================" + party);

            if(party==null) {
                personEntity = delegator.makeValue("PersonEntity");
                personEntity.setNextSeqId();
                personEntity.setPKFields(context);
                personEntity.setNonPKFields(context);
                personEntity = delegator.create(personEntity);
                result.partyId = personEntity.partyId;
                partyId= personEntity.partyId;
//         Debug.log("=========================================" + personEntity.getString("firstName"));
            }else {
//                personEntity.put("partyId",partyId);
//                party.setPKFields(context);
//                party.setNonPKFields(context);

                party.contactMechId = (context.partyId);
                party.roleTypeId = (context.partyId);
                party.firstName = (context.partyId);
                party.lastName = (context.partyId);
                party.emailAddress = (context.partyId);
                party.contactNumber = (context.partyId);
                party.address = (context.partyId);
                party.comments = (context.partyId);
                party = delegator.store(party);
                println "=======1====="
//                result.partyId = personEntity.partyId;
                result.partyId = partyId;
                println "======2========"

            }
//            result.partyId = party.partyId;
            logInfo("==========This is my first Groovy Service implementation in Apache OFBiz. OfbizDemo record " +"created successfully with ofbizDemoId: "+partyId);
    } catch (GenericEntityException e) {
        logError(e.getMessage());
        return error("Error in creating record in OfbizDemo entity ........");
    }
    return result;
} 
